
set(LIB_CURL "curl")

if(MSVC)
ExternalProject_Add(ADD_${LIB_CURL}
        URL ${THIRDPARTY_URL}/curl-${CURL_VERSION}.tar.gz
        DOWNLOAD_DIR ${CMAKE_SOURCE_DIR}/download
        PREFIX ${CMAKE_BINARY_DIR}
        INSTALL_DIR ${CMAKE_SOURCE_DIR}
        CONFIGURE_COMMAND ${CMAKE_COMMAND} . -T${MSVC_TOOLSET_VERSION} -DCMAKE_INSTALL_PREFIX=${THIRDPARTY_PATH}/${LIB_CURL}-${CURL_VERSION} -DBUILD_SHARED_LIBS=${BUILD_SHARED_LIBS} -DBUILD_STATIC_LIBS=${BUILD_STATIC_LIBS} -DCMAKE_POSITION_INDEPENDENT_CODE=ON -DCMAKE_USE_OPENSSL=OFF
        SOURCE_DIR ${THIRDPARTY_PATH}/${LIB_CURL}-lib
        BUILD_IN_SOURCE 1
        BUILD_COMMAND ${CMAKE_COMMAND} --build . --config release 
        URL_MD5 ${CURL_MD5}
        )
else(MSVC)
ExternalProject_Add(ADD_${LIB_CURL}
        URL ${THIRDPARTY_URL}/curl-${CURL_VERSION}.tar.gz
        DOWNLOAD_DIR ${CMAKE_SOURCE_DIR}/download
        PREFIX ${CMAKE_BINARY_DIR}
        INSTALL_DIR ${CMAKE_SOURCE_DIR}
        CONFIGURE_COMMAND ${CMAKE_COMMAND} . -DCMAKE_INSTALL_PREFIX=${THIRDPARTY_PATH}/${LIB_CURL}-${CURL_VERSION} -DBUILD_SHARED_LIBS=${BUILD_SHARED_LIBS} -DBUILD_STATIC_LIBS=${BUILD_STATIC_LIBS} -DCMAKE_POSITION_INDEPENDENT_CODE=ON -DCMAKE_USE_OPENSSL=OFF
        SOURCE_DIR ${THIRDPARTY_PATH}/${LIB_CURL}-lib
        BUILD_IN_SOURCE 1
        BUILD_COMMAND make
        URL_MD5 ${CURL_MD5}
        )
endif(MSVC)
        
add_dependencies(ADD_${LIB_CURL} ADD_${LIB_OPENSSL})

add_dependencies(thirdparty ADD_${LIB_CURL})

install(DIRECTORY ${THIRDPARTY_PATH}/${LIB_CURL}-${CURL_VERSION} USE_SOURCE_PERMISSIONS DESTINATION ${CMAKE_INSTALL_PREFIX})

if(MSVC)
INSTALL(CODE "EXECUTE_PROCESS(COMMAND ${CMAKE_COMMAND} -E remove_directory ${CMAKE_INSTALL_PREFIX}/curl && ${CMAKE_COMMAND} -E copy_directory ${CMAKE_INSTALL_PREFIX}/${LIB_CURL}-${CURL_VERSION} )")
else(MSVC)
INSTALL(CODE "EXECUTE_PROCESS(COMMAND ${CMAKE_COMMAND} -E create_symlink ${CMAKE_INSTALL_PREFIX}/${LIB_CURL}-${CURL_VERSION} ${CMAKE_INSTALL_PREFIX}/curl)")
endif(MSVC)
